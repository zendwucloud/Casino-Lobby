<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Slot Lobby - Stable Version</title>
    <style>
        /* --- ÂÖ®Â±ÄË®≠ÂÆö --- */
        :root {
            --text-gold: #f4d06f;
            --text-white: #ffffff;
            --panel-bg: rgba(20, 22, 35, 0.85);
        }
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        
        /* 1. Body Ë®≠ÂÆö (ÊÅ¢Âæ©ÊúÄÁ©©ÂÆöÁöÑË®≠ÂÆö) */
        body {
            background-color: #000;
            width: 100vw; 
            height: 100vh;
            overflow: hidden;
            font-family: 'Segoe UI', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            /* ËÅöÂÖâÁáàËÉåÊôØ */
            background: radial-gradient(circle at center, #333333 0%, #000000 85%);
        }

        /* 2. App ÂÆπÂô® (Â§ßÂª≥Á∂≠ÊåÅ 9:16ÔºåÈÄôÊòØÊÇ®Ë¶∫ÂæóÊïàÊûúÊúÄÂ•ΩÁöÑ) */
        .app-container {
            height: 100%; 
            aspect-ratio: 9/16;
            max-width: 100vw; 
            position: relative; 
            display: flex;
            flex-direction: column;
            
            background-color: #121212;
            background-image: url('bg.png');
            background-size: 100% 100%; 
            background-repeat: no-repeat;
            
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            z-index: 1; 
            overflow: hidden;
        }

        #lobby-bg-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 2; pointer-events: none; mix-blend-mode: screen; }

        .gradient-border-box::after {
            content: ""; position: absolute; inset: 0; border-radius: inherit; padding: 1.5px; 
            background: linear-gradient(90deg, rgba(170, 135, 65, 0) 0%, #aa8741 25%, #cbbd83 50%, #aa8741 75%, rgba(170, 135, 65, 0) 100%);
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor; mask-composite: exclude;
            pointer-events: none; z-index: 10; 
        }

        /* --- UI Bars --- */
        .top-bar {
            position: absolute; top: 0; left: 0; height: 10%; width: 100%; padding: 0 2%;
            display: flex; align-items: center; justify-content: space-between; z-index: 200;
            background: rgba(20, 22, 35, 0.7); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border-radius: 0 0 4vh 4vh;
            box-shadow: 0 5px 25px rgba(0,0,0,0.5), inset 0 0 25px rgba(255, 220, 150, 0.15);
        }
        .top-bar.gradient-border-box::after { top: -4px; height: calc(100% + 2px); }

        .user-section { display: flex; align-items: center; gap: 6px; width: auto; flex-shrink: 0; margin-right: 5px; }
        .avatar-img { height: 5.5vh; width: 5.5vh; border-radius: 50%; object-fit: cover; border: 2px solid #333; }
        .vip-text { color: var(--text-gold); font-weight: 800; font-size: 1.8vh; letter-spacing: 0.5px; }
        .coin-bar { flex: 1; height: 55%; display: flex; align-items: center; justify-content: space-between; background: rgba(0, 0, 0, 0.2); border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 50px; padding: 0 6px; min-width: 0; }
        .gold-icon { height: 63%; width: auto; flex-shrink: 0; }
        .center-group { flex: 1; display: flex; align-items: center; justify-content: flex-end; min-width: 0; padding-right: 6px; overflow: hidden; }
        .coin-number { color: var(--text-white); font-weight: 900; font-size: 2.7vh; margin-right: 5px; margin-top: -3px; letter-spacing: -0.5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; line-height: 1.1; }
        .coins-text-img { height: 1.2vh; width: auto; margin-top: 8px; opacity: 0.8; flex-shrink: 0; } 
        .clickable-btn { transition: transform 0.1s ease; }
        .clickable-btn:active { transform: scale(0.85); filter: brightness(1.2); }
        .plus-btn { height: 65%; width: auto; cursor: pointer; flex-shrink: 0;}
        .menu-btn { height: 28%; width: auto; cursor: pointer; margin-left: 8px; flex-shrink: 0;}

        /* --- Â∫ïÈÉ®Â∞éËà™ --- */
        .bottom-nav {
            position: absolute; bottom: 2.5vh; left: 3%; width: 94%; height: 11.7%;
            display: flex; justify-content: space-around; align-items: center; z-index: 200;
            background: rgba(20, 22, 35, 0.65); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
            border-radius: 4vh; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.5), inset 0 0 25px rgba(255, 220, 150, 0.15);
        }
        .nav-item { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 0; cursor: pointer; width: 22%; height: 100%; transition: transform 0.1s; }
        .nav-item:active { transform: scale(0.9); }
        .nav-icon { height: 75%; width: auto; object-fit: contain; filter: drop-shadow(0 2px 5px rgba(0,0,0,0.3)); transform: scale(0.85) translateY(2px); transition: transform 0.2s; }
        .nav-label { font-size: 1.6vh; font-weight: 700; color: #aaa; letter-spacing: 0.5px; margin-top: -8px; z-index: 2; text-shadow: 0 1px 2px rgba(0,0,0,0.8); }
        .nav-item.active .nav-icon { animation: breathe 2.5s ease-in-out infinite; }
        .nav-item.active .nav-label { color: #fff; text-shadow: 0 0 8px rgba(255, 255, 255, 0.8); }
        @keyframes breathe {
            0% { transform: scale(1.1) translateY(2px); filter: drop-shadow(0 0 5px rgba(255, 215, 0, 0.4)); }
            50% { transform: scale(1.15) translateY(2px); filter: drop-shadow(0 0 15px rgba(255, 215, 0, 0.8)); }
            100% { transform: scale(1.1) translateY(2px); filter: drop-shadow(0 0 5px rgba(255, 215, 0, 0.4)); }
        }

        /* --- ‰∏ªÈÅäÊà≤ÂàóË°® --- */
        .main-scroll-area {
            flex: 1; overflow-y: auto; overflow-x: hidden;
            padding-top: calc(10% + 50px); padding-bottom: 18%; 
            display: flex; flex-direction: column; gap: 10px; 
            position: relative; z-index: 5; 
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .main-scroll-area::-webkit-scrollbar { display: none; }
        .main-scroll-area.hidden .game-card:nth-child(odd) { transform: translateX(-120%); opacity: 0; }
        .main-scroll-area.hidden .game-card:nth-child(even) { transform: translateX(120%); opacity: 0; }

        .game-card {
            width: 80.6%; aspect-ratio: 2/1; margin: 0 auto; position: relative;
            border-radius: 26px; overflow: hidden; 
            box-shadow: none !important; border: none !important; background: transparent; 
            flex-shrink: 0; opacity: 0; 
            animation: slideIn 0.5s ease-out forwards;
            cursor: pointer;
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55), opacity 0.3s ease;
        }
        .game-card::after {
            content: ""; position: absolute; top: 0; left: 0; width: 200%; height: 100%;
            background: linear-gradient(120deg, rgba(255, 255, 255, 0) 30%, rgba(255, 255, 255, 0.4) 50%, rgba(255, 215, 0, 0.2) 55%, rgba(255, 255, 255, 0) 70%);
            transform: translateX(-150%) skewX(-25deg); pointer-events: none; mix-blend-mode: overlay;
            animation: shimmer 5s infinite;
        }
        .game-card:nth-child(odd)::after { animation-delay: 0s; }
        .game-card:nth-child(even)::after { animation-delay: 2.5s; }
        .game-img { width: 100%; height: 100%; object-fit: cover; display: block; }

        @keyframes launchSequence {
            0% { transform: scale(1); filter: brightness(1); opacity: 1; }
            40% { transform: scale(0.95); filter: brightness(1.3) contrast(1.1) drop-shadow(0 0 30px rgba(255, 215, 0, 0.8)); opacity: 1; }
            100% { transform: scale(1.15); filter: brightness(1.5) drop-shadow(0 0 60px rgba(255, 215, 0, 0)); opacity: 0; }
        }
        .game-card.launching { opacity: 1 !important; animation: launchSequence 0.5s ease-in-out forwards; z-index: 999; pointer-events: none; }
        .game-card.launching::after { opacity: 0; transition: opacity 0.1s; }
        @keyframes slideIn { 0% { opacity: 0; transform: translateY(80px); } 70% { opacity: 1; transform: translateY(-5px); } 100% { opacity: 1; transform: translateY(0); } }
        @keyframes shimmer { 0% { transform: translateX(-150%) skewX(-25deg); } 60% { transform: translateX(150%) skewX(-25deg); } 100% { transform: translateX(150%) skewX(-25deg); } }
        .game-card:nth-child(1) { animation-delay: 0.1s; } .game-card:nth-child(2) { animation-delay: 0.2s; } .game-card:nth-child(3) { animation-delay: 0.3s; } .game-card:nth-child(4) { animation-delay: 0.4s; } .game-card:nth-child(5) { animation-delay: 0.5s; }


        /* --- Slots Dashboard Panel --- */
        #slots-panel {
            position: absolute;
            top: 48%; left: 50%;
            height: 72%; width: 90%; 
            
            background: var(--panel-bg);
            backdrop-filter: blur(30px); -webkit-backdrop-filter: blur(30px);
            
            border-radius: 20px; z-index: 150; 
            display: flex; flex-direction: column;
            opacity: 0; pointer-events: none;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform: translate(-50%, -50%) scale(0.8);
            box-shadow: 0 20px 50px rgba(0,0,0,0.8);
        }

        #slots-panel.active { opacity: 1; pointer-events: all; transform: translate(-50%, -50%) scale(1); }

        .panel-header {
            height: 10%; display: flex; justify-content: space-around; align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1); padding: 0 10px; flex-shrink: 0;
        }
        .tab-item { color: #888; font-size: 1.6vh; font-weight: 700; cursor: pointer; position: relative; padding: 5px 0; transition: color 0.3s; }
        .tab-item.active { color: var(--text-gold); text-shadow: 0 0 10px rgba(244, 208, 111, 0.5); }
        .tab-item.active::after { content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 2px; background: var(--text-gold); box-shadow: 0 0 5px var(--text-gold); }

        .panel-content {
            flex: 1; padding: 15px 10px; overflow-y: auto;
            scrollbar-width: thin; scrollbar-color: #aa8741 rgba(255, 255, 255, 0.1);
        }
        .panel-content::-webkit-scrollbar { width: 5px; }
        .panel-content::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.05); border-radius: 10px; }
        .panel-content::-webkit-scrollbar-thumb { background: linear-gradient(180deg, #aa8741, #cbbd83); border-radius: 10px; }

        .slots-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; width: 100%; }
        
        .slot-icon {
            width: 100%; aspect-ratio: 2/1; border-radius: 8px; overflow: hidden;
            background: #000; position: relative; border: 1px solid rgba(255, 255, 255, 0.15);
            transition: transform 0.1s;
        }
        .slot-icon:active { transform: scale(0.9); border-color: var(--text-gold); }
        .slot-thumb { width: 100%; height: 100%; object-fit: cover; }

        .panel-footer {
            height: 14%; display: flex; justify-content: center; align-items: center;
            padding: 0 20px; border-top: 1px solid rgba(255, 255, 255, 0.1); flex-shrink: 0;
        }
        
        .close-gold-btn {
            background: linear-gradient(180deg, #ffeebb 0%, #aa8741 50%, #75551d 100%);
            border: 1px solid #ffd700; border-radius: 20px; padding: 8px 45px; 
            color: #422100; font-weight: 800; font-size: 1.8vh; letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5); cursor: pointer; transition: transform 0.1s;
        }
        .close-gold-btn:active { transform: scale(0.95); filter: brightness(1.1); }


        /* --- Overlay & Game Container --- */
        #transition-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 10000; opacity: 0; pointer-events: none; transition: opacity 0.5s ease-in-out; }
        #transition-overlay.active { opacity: 1; pointer-events: all; }
        
        /* „ÄêÈóúÈçµ‰øÆÊ≠£„ÄëÂº∑Âà∂ÈÅäÊà≤ÂÆπÂô®‰ΩîÊªø 100vw x 100vhÔºå‰∏çÁêÜÊúÉÁà∂Â±§ÊØî‰æã */
        #game-container { 
            position: fixed; 
            top: 0; left: 0; right: 0; bottom: 0;
            width: 100vw; height: 100vh; 
            z-index: 20000; /* Â±§Á¥öÊúÄÈ´ò */
            background: #000; 
            display: none; 
        }
        #game-frame { width: 100%; height: 100%; border: none; display: block; }
        
        /* ÈóúÈñâÊåâÈàïÁ®çÂæÆÂæÄ‰∏ãÁßªÔºåÈÅøÈñãÊâãÊ©üÁÄèÊµ∑ */
        #close-game-btn {
            position: absolute; top: 40px; left: 20px; z-index: 20001;
            /* ...ÂéüÊú¨ÁöÑÊ®£Âºè... */
            
            /* ‚ñº‚ñº‚ñº Êñ∞Â¢ûÈÄô‰∏ÄË°å‰æÜÈö±ËóèÂÆÉ ‚ñº‚ñº‚ñº */
            display: none !important; 
        }
        #close-game-btn:active { transform: scale(0.9); background: rgba(255, 0, 0, 0.6); }

    </style>
</head>
<body>

    <div class="app-container">
        
        <canvas id="lobby-bg-canvas"></canvas>

        <header class="top-bar gradient-border-box">
            <div class="user-section">
                <img src="player.png" class="avatar-img" alt="User">
                <span class="vip-text">VIP.1</span>
            </div>
            <div class="coin-bar">
                <img src="gold.png" class="gold-icon" alt="G">
                <div class="center-group">
                    <span class="coin-number">9,876,543,210.00</span>
                    <img src="coins.png" class="coins-text-img" alt="COINS">
                </div>
                <img src="+.png" class="plus-btn clickable-btn" alt="+">
            </div>
            <img src="option.png" class="menu-btn clickable-btn" alt="Menu">
        </header>

        <main class="main-scroll-area">
            <div class="game-card" id="game-dragon"><img src="game001.png" class="game-img" alt="Dragon"></div>
            <div class="game-card"><img src="game002.png" class="game-img" alt="Game 2"></div>
            <div class="game-card"><img src="game003.png" class="game-img" alt="Game 3"></div>
            <div class="game-card"><img src="game004.png" class="game-img" alt="Game 4"></div>
            <div class="game-card"><img src="game001.png" class="game-img" alt="Game 5"></div>
            <div style="height: 5vh;"></div>
        </main>

        <div id="slots-panel" class="gradient-border-box">
            <div class="panel-header">
                <div class="tab-item active">ÂÖ®ÈÉ®</div>
                <div class="tab-item">ÁÜ±ÈñÄ üî•</div>
                <div class="tab-item">Êñ∞ÈÅäÊà≤ üíé</div>
                <div class="tab-item">ÊúÄÊÑõ ‚ù§Ô∏è</div>
            </div>
            <div class="panel-content">
                <div class="slots-grid">
                    <div class="slot-icon"><img src="game001.png" class="slot-thumb"></div>
                    <div class="slot-icon"><img src="game002.png" class="slot-thumb"></div>
                    <div class="slot-icon"><img src="game003.png" class="slot-thumb"></div>
                    <div class="slot-icon"><img src="game004.png" class="slot-thumb"></div>
                    <div class="slot-icon"><img src="game001.png" class="slot-thumb"></div>
                    <div class="slot-icon"><img src="game002.png" class="slot-thumb"></div>
                    <div class="slot-icon"><img src="game003.png" class="slot-thumb"></div>
                    <div class="slot-icon"><img src="game004.png" class="slot-thumb"></div>
                    <div class="slot-icon"><img src="game001.png" class="slot-thumb"></div>
                    <div class="slot-icon"><img src="game002.png" class="slot-thumb"></div>
                    <div class="slot-icon"><img src="game003.png" class="slot-thumb"></div>
                    <div class="slot-icon"><img src="game004.png" class="slot-thumb"></div>
                </div>
            </div>
            <div class="panel-footer">
                <div class="close-gold-btn" id="close-slots-btn">CLOSE</div>
            </div>
        </div>

        <nav class="bottom-nav gradient-border-box">
            <div class="nav-item active" id="nav-home">
                <img src="home.png" class="nav-icon" alt="Home">
                <span class="nav-label">Home</span>
            </div>
            <div class="nav-item" id="nav-slots">
                <img src="games.png" class="nav-icon" alt="Slots">
                <span class="nav-label">Slots</span>
            </div>
            <div class="nav-item">
                <img src="events.png" class="nav-icon" alt="Rewards">
                <span class="nav-label">Rewards</span>
            </div>
            <div class="nav-item">
                <img src="profile.png" class="nav-icon" alt="Profile">
                <span class="nav-label">Profile</span>
            </div>
        </nav>
    </div>

    <div id="transition-overlay"></div>
    <div id="game-container">
        <button id="close-game-btn">‚úï</button>
    </div>

    <script>
        const navItems = document.querySelectorAll('.nav-item');
        const mainScroll = document.querySelector('.main-scroll-area');
        const slotsPanel = document.getElementById('slots-panel');
        const closeSlotsBtn = document.getElementById('close-slots-btn');
        const navHome = document.getElementById('nav-home');
        
        navItems.forEach(item => {
            item.addEventListener('click', () => {
                navItems.forEach(i => i.classList.remove('active'));
                item.classList.add('active');
                if (item.id === 'nav-slots') openSlotsPanel();
                else if (item.id === 'nav-home') closeSlotsPanel();
                else closeSlotsPanel();
            });
        });

        function openSlotsPanel() {
            mainScroll.classList.add('hidden');
            setTimeout(() => { slotsPanel.classList.add('active'); }, 200);
        }

        function closeSlotsPanel() {
            slotsPanel.classList.remove('active');
            setTimeout(() => { mainScroll.classList.remove('hidden'); }, 200);
            navItems.forEach(i => i.classList.remove('active'));
            navHome.classList.add('active');
        }

        closeSlotsBtn.addEventListener('click', closeSlotsPanel);

        const tabs = document.querySelectorAll('.tab-item');
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
            });
        });

// --- Êñ∞Â¢ûÔºöÁõ£ËÅΩ‰æÜËá™ÈÅäÊà≤ÁöÑÈóúÈñâË®äËôü ---
        window.addEventListener('message', (event) => {
            if (event.data === 'closeGame') {
                // ÈÄôË£°Âü∑Ë°åÂéüÊú¨ X ÊåâÈàïÁöÑÈóúÈñâÈÇèËºØ
                const overlay = document.getElementById('transition-overlay');
                const gameContainer = document.getElementById('game-container');
                const dragonCard = document.getElementById('game-dragon');
                
                // 1. È°ØÁ§∫ÈªëÂπï
                overlay.classList.add('active'); 
                
                // 2. Á≠âÂæÖÈªëÂπïËìãÊªøÂæåÁßªÈô§ iframe
                setTimeout(() => {
                    gameContainer.style.display = 'none';
                    const iframe = document.getElementById('game-frame');
                    if(iframe) iframe.remove(); // ÂæπÂ∫ïÁßªÈô§ iframe ‰ª•ÂÅúÊ≠¢ÈÅäÊà≤ËÅ≤Èü≥
                    
                    if(dragonCard) dragonCard.classList.remove('launching');
                    
                    // 3. ÊâìÈñãÈªëÂπïÔºåÂõûÂà∞Â§ßÂª≥
                    overlay.classList.remove('active'); 
                }, 500);
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            const dragonCard = document.getElementById('game-dragon');
            const overlay = document.getElementById('transition-overlay');
            const gameContainer = document.getElementById('game-container');
            const closeBtn = document.getElementById('close-game-btn');
            const dragonUrl = "https://zendwucloud.github.io/Dragon-Treasure/"; 

            if (dragonCard) {
                dragonCard.addEventListener('click', function() {
                    if (this.classList.contains('launching')) return;
                    this.classList.add('launching');
                    setTimeout(() => {
                        overlay.classList.add('active'); 
                        setTimeout(() => {
                            let iframe = document.createElement('iframe');
                            iframe.id = "game-frame";
                            iframe.src = dragonUrl;
                            iframe.allow = "autoplay; fullscreen";
                            const oldFrame = document.getElementById('game-frame');
                            if(oldFrame) oldFrame.remove();
                            gameContainer.appendChild(iframe);
                            gameContainer.style.display = 'block';
                            iframe.onload = () => { setTimeout(() => { overlay.classList.remove('active'); }, 300); };
                            setTimeout(() => { if(overlay.classList.contains('active')) overlay.classList.remove('active'); }, 1500);
                        }, 500); 
                    }, 400);
                });
            }

            const otherCards = document.querySelectorAll('.game-card:not(#game-dragon)');
            otherCards.forEach(card => {
                card.addEventListener('click', function() {
                    if (this.classList.contains('launching')) return;
                    this.classList.add('launching');
                    setTimeout(() => { this.classList.remove('launching'); }, 500);
                });
            });

            if (closeBtn) {
                closeBtn.addEventListener('click', () => {
                    overlay.classList.add('active'); 
                    setTimeout(() => {
                        gameContainer.style.display = 'none';
                        const iframe = document.getElementById('game-frame');
                        if(iframe) iframe.remove();
                        if(dragonCard) dragonCard.classList.remove('launching');
                        overlay.classList.remove('active'); 
                    }, 500);
                });
            }
        });

        (function initLobbyBackground() {
            const canvas = document.getElementById('lobby-bg-canvas');
            const container = document.querySelector('.app-container'); 
            if (!canvas || !container) return;
            const ctx = canvas.getContext('2d');
            let width, height, particles = [];
            const particleCount = 200;

            function resize() {
                width = container.clientWidth;
                height = container.clientHeight;
                canvas.width = width;
                canvas.height = height;
            }

            class Particle {
                constructor() { this.reset(true); }
                reset(isInit = false) {
                    let randX = (Math.random() + Math.random()) / 2;
                    this.x = randX * width;
                    this.y = isInit ? Math.random() * height : height + Math.random() * 50;
                    let speedFactor = 1 - Math.abs(randX - 0.5) * 5; 
                    this.vy = -(Math.random() * 1.2 + 0.5 + speedFactor * 0.8); 
                    this.vx = (Math.random() - 0.5) * 0.2; 
                    this.size = Math.random() * 2.5 + 0.5;
                    this.maxAlpha = Math.random() * 0.5 + 0.3; 
                    this.alpha = this.maxAlpha;
                    this.color = `244, 208, 111`; 
                }
                update() {
                    this.x += this.vx; this.y += this.vy; 
                    let fadeStartPoint = height * 0.5;
                    if (this.y < fadeStartPoint) {
                        this.alpha = (this.y / fadeStartPoint) * this.maxAlpha;
                        if (this.alpha < 0) this.alpha = 0;
                    } else { this.alpha = this.maxAlpha; }
                    if (this.y < -10) this.reset(false);
                }
                draw() {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(${this.color}, ${this.alpha})`;
                    if (this.alpha > 0.01) { ctx.shadowBlur = 10; ctx.shadowColor = `rgba(${this.color}, 0.8)`; }
                    ctx.fill(); ctx.shadowBlur = 0; 
                }
            }
            function initParticles() { particles = []; for (let i = 0; i < particleCount; i++) particles.push(new Particle()); }
            function drawPillar() {
                ctx.globalCompositeOperation = 'screen'; 
                let gradient = ctx.createRadialGradient(width/2, height/2, 1, width/2, height/2, width * 0.75);
                gradient.addColorStop(0, "rgba(244, 208, 111, 0.25)"); 
                gradient.addColorStop(0.5, "rgba(20, 20, 20, 0.1)");
                gradient.addColorStop(1, "rgba(0, 0, 0, 0)");
                ctx.fillStyle = gradient; ctx.fillRect(0, 0, width, height);
                let pillarWidth = width * 0.25;
                let linearGrad = ctx.createLinearGradient(width/2 - pillarWidth/2, 0, width/2 + pillarWidth/2, 0);
                linearGrad.addColorStop(0, "rgba(0,0,0,0)");
                linearGrad.addColorStop(0.5, "rgba(244, 208, 111, 0.12)");
                linearGrad.addColorStop(1, "rgba(0,0,0,0)");
                ctx.fillStyle = linearGrad; ctx.fillRect(width/2 - pillarWidth/2, 0, pillarWidth, height);
                ctx.globalCompositeOperation = 'source-over'; 
            }
            function animate() {
                ctx.clearRect(0, 0, width, height);
                drawPillar();
                particles.forEach(p => { p.update(); p.draw(); });
                requestAnimationFrame(animate);
            }
            window.addEventListener('resize', resize);
            resize(); initParticles(); animate();
        })();
    </script>
</body>
</html>